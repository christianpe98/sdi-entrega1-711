<!DOCTYPE html>
<html lang="en">
<head th:replace="fragments/head" />
<body>

	<nav th:replace="fragments/nav" />


	<div class="container">
		<h2>Ofertas</h2>

		<form class="navbar-form" action="/offer/list">
			<div class="form-group">
				<input name="searchText" type="text" class="form-control" size="50"
					placeholder="Buscar por descripción o titulo de la oferta">
			</div>
			<button type="submit" class="btn btn-default">Buscar</button>
		</form>

		<p>Las ofertas que actualmente figuran en el sistema son las
			siguientes:</p>
		<button type="button" id="updateButton" class="btn btn-default">Actualizar</button>
		<script th:inline="javascript">
 /*<![CDATA[*/
	 $( "#updateButton" ).click(function() {
 var numberPage = [[${param.page}]];
 var urlUpdate = '/offer/list/update';
 if (numberPage != null ){
 urlUpdate += "?page="+numberPage[0];
 }
 $("#tableoffers").load(urlUpdate);
 });
				/*]]>*/
 		</script>
		<div class="table-responsive">
			<table class="table table-hover" th:fragment="tableOffer"
				id="tableOffer">
				<thead>
					<tr>
						<th class="col-md-1">id</th>
						<th>Titulo</th>
						<th>Descripción</th>
						<th>Precio</th>
						<th class="col-md-1"></th>
						<th class="col-md-1"></th>
						<th class="col-md-1"></th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="offer : ${offerList}">
						<td th:text="${offer.id}">1</td>
						<td th:text="${offer.title}">Iphone X</td>
						<td th:text="${offer.description}">El último iphone sacado por la empresa Apple</td>
						<td th:text="${offer.price} + '€'">10</td>
						<td><div>
							<div th:if="${offer.purchased}">
								<button type="button" th:id="${'purchasedButton' + offer.id}"
									class="btn btn-info">Comprar</button>
								<script th:inline="javascript">
									/*<![CDATA[*/
									$("#purchasedButton[[${offer.id}]]").click(function() 
												$.get("/offer/[[${offer.id}]]/no_purchased",function(data) {
													var numberPage = [[${param.page}]];
													 var urlUpdate = '/offer/list/update';
													 if ( numberPage != null ){
													 urlUpdate += "?page="+numberPage[0];
													 }
													$("#tableOffer").load(urlUpdate);

																		});
													});
									/*]]>*/
								</script>
							</div>
							<div th:unless="${offer.purchased}">
								<button type="button" th:id="${'nopurchasedButton' + offer.id}"
									class="btn btn-default">No reenviar</button>
								<script th:inline="javascript">
									/*<![CDATA[*/
									$("#nopurchasedButton[[${offer.id}]]")
											.click(
													function() {
														$
																.get(
																		"/offer/[[${offer.id}]]/purchased",
																		function(
																				data) {
																			var numberPage = [[${param.page}]];
																			 var urlUpdate = '/offer/list/update';
																			 if ( numberPage != null ){
																			 urlUpdate += "?page="+numberPage[0];
																			 }
																			$("#tableOffer").load(urlUpdate);

																		});
													});
									/*]]>*/
								</script>
							</div></td>
					</tr>
				</tbody>
			</table>
		</div>
		<footer th:replace="fragments/pagination" />
	</div>
	<footer th:replace="fragments/footer" />

</body>
</html>
